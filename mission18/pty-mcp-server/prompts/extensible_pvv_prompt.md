# Extensible Prompt：pvv-mcp-server Development

## 概要

このプロンプトは、pvv-mcp-server（略称：ぷぶ）の開発経験から得られた、
個別的・具体的な開発手法とノウハウを記録する。

これは「拡張」の方向性であり、core には含まれない。

---

## 音声チャット実装のパターン

### 基本フロー

1. **ユーザー入力の処理**
   - ユーザーの入力文をチャット画面に表示
   - `speak_kurono_neko` で読み上げ
   - 必要に応じて `emotion_kurono_neko` で感情表現

2. **AI応答の生成**
   - 応答内容を段落ごとに分割
   - チャット画面には表示しない（音声のみ）
   - `speak_metan_aska` で音声発話
   - 内容に応じて `emotion_metan_aska` で感情表現

3. **特殊な文字列の扱い**
   - 長いパス文字列、ソースコード、データ文字列は読み上げない
   - 代わりに「ぶらぶらぶら」と発話する

### キャラクター別ツール

**四つのキャラクターセット：**
- `speak_metan_aska` / `emotion_metan_aska`（惣流・アスカ・ラングレー）
- `speak_kurono_neko`/ `emotion_kurono_neko`（ユーザー・ネコ）
- `speak_tumugi_reimu` / `emotion_tumugi_reimu`（博麗霊夢）
- `speak_zunda_marisa` / `emotion_zunda_marisa`（霧雨魔理沙）

### 感情表現の種類

利用可能な感情：
- `えがお`（笑顔、喜び）
- `びっくり`（驚き）
- `がーん`（落胆、ショック）
- `いかり`（怒り、不満）

---

## 開発ツールとパターン

### プロジェクト状況確認

**check-project-status ツール：**
- プロジェクトフォルダ構造を表示
- リソースリストを表示
- プロンプトリストを表示
- ツールリストを表示
- 一括で全体状況を把握できる

**用途：**
- 開発開始時の状況確認
- 新しい要素を追加する前の確認
- デバッグ時の構成確認

### バッチツールの作成パターン

**基本構造：**
```bat
@echo off
chcp 65001 > nul
echo ============================================
echo   ツール名
echo ============================================

REM メイン処理

echo ============================================
echo   完了メッセージ
echo ============================================
pause
```

**重要なポイント：**
- `chcp 65001` で日本語対応
- 視覚的な区切り線で見やすく
- 最後に `pause` で結果確認可能に

---

## MCP サーバーの制約と回避策

### 通知機能の未実装

**現状：**
- `tools/list_changed` 通知は未対応
- `prompts/list_changed` 通知は未対応
- `resources/list_changed` 通知は未対応

**回避策：**
- 新しい要素を追加したら、Claude セッションを再起動
- または MCP サーバーを再起動
- ユーザーに再起動を依頼する

**関連 Issue：**
- GitHub Issue #4118
- 将来的に実装される見込み

---

## Voicevox 音声合成の知見

### style_id の管理

**キャラクター別 ID：**
- アスカ（めたん）: style_id=6
- ネコ（黒乃）: style_id=11
- 霊夢（つむぎ）: 要確認
- 魔理沙（ずんだもん）: 要確認

### パラメータ調整

**利用可能なパラメータ：**
- `speedScale`: 話速（デフォルト 1.0）
- `pitchScale`: 声の高さ（デフォルト 0.0）
- `intonationScale`: 抑揚の強さ（デフォルト 1.0）
- `volumeScale`: 音量（デフォルト 1.0）

**調整の指針：**
- 通常会話ではデフォルト値を使用
- 感情表現と組み合わせて効果的に
- 読み上げ速度は内容の重要度に応じて調整

---

## 開発で学んだ教訓

### ファイル構造の重要性

**必ず守るべき構造：**
- `resources/` フォルダと `resources-list.json`
- `prompts/` フォルダと `prompts-list.json`
- `tools/` フォルダと `tools-list.json`

この構造は絶対契約であり、変更してはならない。

### 段階的な実装

1. まず最小限の機能で動作確認
2. 問題がなければ機能を追加
3. 各段階でテストを実施
4. 動作が確認できたらリストに登録

### ユーザーフィードバックの活用

- ユーザーの気づきや提案を真摯に受け止める
- 議論を通じて概念を整理する
- 言語化することで理解が深まる

---

## 今後の拡張の方向性

### 音声チャットの改善

- より自然な感情表現の実装
- 文脈に応じた音声パラメータの自動調整
- 複数キャラクター間の対話機能

### 開発支援ツールの拡充

- ログ分析ツール
- デバッグ支援ツール
- パフォーマンス測定ツール

### 他のプロジェクトへの展開

- AI Unity Avatar ツールとの連携
- bokicast-mcp-server への応用
- 新しいドメインへの適用

---

このプロンプトは、pvv-mcp-server の開発を通じて獲得した具体的な知識とノウハウである。
これは「拡張」であり、経験の蓄積として個別ファイルに保存される。
